<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>OpenNN examples</title>

    <link href="../stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="../stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="../javascripts/all_nosearch.js" type="text/javascript"></script>

  </head>

  <body class="includes includes_optimal_control_problems">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="../images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <div style="background-color: white">
        <center>
        <img src="../images/logo.png" />
        </center>
      </div>
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="optimal-control-problems">Optimal control problems</h1>

<h2 id="car-problem">Car problem</h2>
<pre class="highlight cpp"><code><span class="cp">#include &lt;iostream&gt;
#include &lt;time.h&gt;
</span>
<span class="cp">#include "../../source/opennn.h"
</span>
<span class="cp">#include "car.h"
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">OpenNN</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>

    <span class="n">srand</span><span class="p">((</span><span class="kt">unsigned</span><span class="p">)</span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">));</span>

    <span class="k">const</span> <span class="kt">double</span> <span class="n">maximum_acceleration</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">double</span> <span class="n">maximum_deceleration</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>

    <span class="k">const</span> <span class="kt">double</span> <span class="n">final_position</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">double</span> <span class="n">final_velocity</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

    <span class="n">Car</span> <span class="n">car</span><span class="p">;</span>

    <span class="n">NeuralNetwork</span> <span class="n">neural_network</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">neural_network</span><span class="p">.</span><span class="n">initialize_parameters_normal</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">);</span>

    <span class="n">neural_network</span><span class="p">.</span><span class="n">construct_inputs_outputs_information</span><span class="p">();</span>

    <span class="n">InputsOutputsInformation</span><span class="o">*</span> <span class="n">inputs_outputs_information_pointer</span> <span class="o">=</span> <span class="n">neural_network</span><span class="p">.</span><span class="n">get_inputs_outputs_information_pointer</span><span class="p">();</span>

    <span class="n">inputs_outputs_information_pointer</span><span class="o">-&gt;</span><span class="n">set_input_name</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"time"</span><span class="p">);</span>

    <span class="n">inputs_outputs_information_pointer</span><span class="o">-&gt;</span><span class="n">set_output_name</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"throttle_acceleration"</span><span class="p">);</span>
    <span class="n">inputs_outputs_information_pointer</span><span class="o">-&gt;</span><span class="n">set_output_name</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">"bracking_deceleration"</span><span class="p">);</span>

    <span class="n">neural_network</span><span class="p">.</span><span class="n">construct_scaling_layer</span><span class="p">();</span>

    <span class="n">ScalingLayer</span><span class="o">*</span> <span class="n">scaling_layer_pointer</span> <span class="o">=</span> <span class="n">neural_network</span><span class="p">.</span><span class="n">get_scaling_layer_pointer</span><span class="p">();</span>

    <span class="n">scaling_layer_pointer</span><span class="o">-&gt;</span><span class="n">set_minimum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>

    <span class="n">neural_network</span><span class="p">.</span><span class="n">set_scaling_layer_flag</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>

    <span class="n">neural_network</span><span class="p">.</span><span class="n">construct_unscaling_layer</span><span class="p">();</span>

    <span class="n">UnscalingLayer</span><span class="o">*</span> <span class="n">unscaling_layer_pointer</span> <span class="o">=</span> <span class="n">neural_network</span><span class="p">.</span><span class="n">get_unscaling_layer_pointer</span><span class="p">();</span>

    <span class="n">unscaling_layer_pointer</span><span class="o">-&gt;</span><span class="n">set_minimum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
    <span class="n">unscaling_layer_pointer</span><span class="o">-&gt;</span><span class="n">set_maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum_acceleration</span><span class="p">);</span>

    <span class="n">unscaling_layer_pointer</span><span class="o">-&gt;</span><span class="n">set_minimum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">maximum_deceleration</span><span class="p">);</span>
    <span class="n">unscaling_layer_pointer</span><span class="o">-&gt;</span><span class="n">set_maximum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>

    <span class="n">neural_network</span><span class="p">.</span><span class="n">set_unscaling_layer_flag</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>

    <span class="n">neural_network</span><span class="p">.</span><span class="n">construct_bounding_layer</span><span class="p">();</span>

    <span class="n">BoundingLayer</span><span class="o">*</span> <span class="n">bounding_layer_pointer</span> <span class="o">=</span> <span class="n">neural_network</span><span class="p">.</span><span class="n">get_bounding_layer_pointer</span><span class="p">();</span>

    <span class="n">bounding_layer_pointer</span><span class="o">-&gt;</span><span class="n">set_lower_bound</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
    <span class="n">bounding_layer_pointer</span><span class="o">-&gt;</span><span class="n">set_upper_bound</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum_acceleration</span><span class="p">);</span>

    <span class="n">bounding_layer_pointer</span><span class="o">-&gt;</span><span class="n">set_lower_bound</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">maximum_deceleration</span><span class="p">);</span>
    <span class="n">bounding_layer_pointer</span><span class="o">-&gt;</span><span class="n">set_upper_bound</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>

    <span class="n">neural_network</span><span class="p">.</span><span class="n">construct_independent_parameters</span><span class="p">();</span>

    <span class="n">IndependentParameters</span><span class="o">*</span> <span class="n">independent_parameters_pointer</span> <span class="o">=</span> <span class="n">neural_network</span><span class="p">.</span><span class="n">get_independent_parameters_pointer</span><span class="p">();</span>

    <span class="n">independent_parameters_pointer</span><span class="o">-&gt;</span><span class="n">set_parameters_number</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">independent_parameters_pointer</span><span class="o">-&gt;</span><span class="n">set_parameter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">3.1415927</span><span class="p">);</span>

    <span class="n">independent_parameters_pointer</span><span class="o">-&gt;</span><span class="n">set_name</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"final_time"</span><span class="p">);</span>

    <span class="n">independent_parameters_pointer</span><span class="o">-&gt;</span><span class="n">set_lower_bound</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>

    <span class="n">independent_parameters_pointer</span><span class="o">-&gt;</span><span class="n">set_bounding_flag</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>

    <span class="n">PerformanceFunctional</span> <span class="n">performance_functional</span><span class="p">(</span><span class="o">&amp;</span><span class="n">neural_network</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">car</span><span class="p">);</span>

    <span class="n">IndependentParametersError</span><span class="o">*</span> <span class="n">independent_parameters_error</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IndependentParametersError</span><span class="p">(</span><span class="o">&amp;</span><span class="n">neural_network</span><span class="p">);</span>

    <span class="n">independent_parameters_error</span><span class="o">-&gt;</span><span class="n">set_independent_parameter_error_weight</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0e-3</span><span class="p">);</span>

    <span class="n">performance_functional</span><span class="p">.</span><span class="n">set_objective_term_pointer</span><span class="p">(</span><span class="n">independent_parameters_error</span><span class="p">);</span>

    <span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">parameters</span> <span class="o">=</span> <span class="n">neural_network</span><span class="p">.</span><span class="n">arrange_parameters</span><span class="p">();</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">independent_parameters_error</span><span class="o">-&gt;</span><span class="n">calculate_evaluation</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">independent_parameters_error</span><span class="o">-&gt;</span><span class="n">calculate_evaluation</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">independent_parameters_error</span><span class="o">-&gt;</span><span class="n">calculate_gradient</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">FinalSolutionsError</span><span class="o">*</span> <span class="n">final_solutions_error</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FinalSolutionsError</span><span class="p">(</span><span class="o">&amp;</span><span class="n">neural_network</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">car</span><span class="p">);</span>

    <span class="n">final_solutions_error</span><span class="o">-&gt;</span><span class="n">set_target_final_solution</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">final_position</span><span class="p">);</span>
    <span class="n">final_solutions_error</span><span class="o">-&gt;</span><span class="n">set_target_final_solution</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">final_velocity</span><span class="p">);</span>

    <span class="n">final_solutions_error</span><span class="o">-&gt;</span><span class="n">set_final_solution_error_weight</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
    <span class="n">final_solutions_error</span><span class="o">-&gt;</span><span class="n">set_final_solution_error_weight</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">final_solutions_error</span><span class="o">-&gt;</span><span class="n">calculate_evaluation</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">final_solutions_error</span><span class="o">-&gt;</span><span class="n">calculate_evaluation</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">final_solutions_error</span><span class="o">-&gt;</span><span class="n">calculate_gradient</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">performance_functional</span><span class="p">.</span><span class="n">set_constraints_term_pointer</span><span class="p">(</span><span class="n">final_solutions_error</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">performance_functional</span><span class="p">.</span><span class="n">calculate_evaluation</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">performance_functional</span><span class="p">.</span><span class="n">calculate_evaluation</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">performance_functional</span><span class="p">.</span><span class="n">calculate_gradient</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">TrainingStrategy</span> <span class="n">training_strategy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">performance_functional</span><span class="p">);</span>
    <span class="n">training_strategy</span><span class="p">.</span><span class="n">construct_initialization_training_algorithm</span><span class="p">(</span><span class="n">TrainingStrategy</span><span class="o">::</span><span class="n">EVOLUTIONARY_ALGORITHM</span><span class="p">);</span>

    <span class="n">training_strategy</span><span class="p">.</span><span class="n">construct_main_training_algorithm</span><span class="p">(</span><span class="n">TrainingStrategy</span><span class="o">::</span><span class="n">GRADIENT_DESCENT</span><span class="p">);</span>

    <span class="k">const</span> <span class="n">TrainingStrategy</span><span class="o">::</span><span class="n">Results</span> <span class="n">training_strategy_results</span> <span class="o">=</span> <span class="n">training_strategy</span><span class="p">.</span><span class="n">perform_training</span><span class="p">();</span>

    <span class="k">const</span> <span class="kt">double</span> <span class="n">final_time</span> <span class="o">=</span> <span class="n">neural_network</span><span class="p">.</span><span class="n">get_independent_parameters_pointer</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">get_parameter</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="n">car</span><span class="p">.</span><span class="n">set_final_independent_variable</span><span class="p">(</span><span class="n">final_time</span><span class="p">);</span>

    <span class="n">car</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">"../data/car_problem/car.xml"</span><span class="p">);</span>
    <span class="n">car</span><span class="p">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">neural_network</span><span class="p">,</span> <span class="s">"../data/car_problem/car_data.dat"</span><span class="p">);</span>

    <span class="n">neural_network</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">"../data/car_problem/neural_network.xml"</span><span class="p">);</span>
    <span class="n">neural_network</span><span class="p">.</span><span class="n">save_expression</span><span class="p">(</span><span class="s">"../data/car_problem/expression.txt"</span><span class="p">);</span>
    <span class="n">neural_network</span><span class="p">.</span><span class="n">save_data</span><span class="p">(</span><span class="s">"../data/car_problem/neural_network_data.dat"</span><span class="p">);</span>

    <span class="n">performance_functional</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">"../data/car_problem/performance_functional.xml"</span><span class="p">);</span>

    <span class="n">training_strategy</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">"../data/car_problem/training_strategy.xml"</span><span class="p">);</span>
    <span class="n">training_strategy_results</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">"../data/car_problem/training_strategy_results.dat"</span><span class="p">);</span>

    <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>

<p><img alt="Alt text" src="../images/CarProblem.gif" /></p>

<p><br>
<br>
Problem parameters
<br>
<br>
<br>
<br>
Mathematical model</p>

<p>Neural network
<br>
<br>
Inputs-outputs information
<br>
<br>
<br>
<br>
<br>
<br>
<br>
Scaling layer
<br>
<br>
<br>
<br>
<br>
Unscaling layer
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
Bounding layer
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
Independent parameters
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
Performance functional</p>

<p>Objective term
<br>
<br>
<br>
<br>
Constraints term
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
Training strategy
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
Save results</p>

<h2 id="maximal-feed-rate-to-a-fed-batch-fermenter">Maximal feed rate to a fed batch fermenter</h2>
<pre class="highlight cpp"><code><span class="cp">#include &lt;iostream&gt;
#include &lt;time.h&gt;
#include "../../source/opennn.h"
#include "fed_batch_fermenter.h"
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">OpenNN</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">srand</span><span class="p">((</span><span class="kt">unsigned</span><span class="p">)</span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">));</span>

    <span class="kt">double</span> <span class="n">fermenter_volume</span> <span class="o">=</span> <span class="mf">200.0</span><span class="p">;</span>

    <span class="kt">double</span> <span class="n">maximum_feed_rate</span> <span class="o">=</span> <span class="mf">12.0</span><span class="p">;</span>

    <span class="kt">double</span> <span class="n">final_time</span> <span class="o">=</span> <span class="mf">54.0</span><span class="p">;</span>

    <span class="n">FedBatchFermenter</span> <span class="n">fed_batch_fermenter</span><span class="p">;</span>

    <span class="n">NeuralNetwork</span> <span class="n">neural_network</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

    <span class="n">neural_network</span><span class="p">.</span><span class="n">construct_inputs_outputs_information</span><span class="p">();</span>

    <span class="n">InputsOutputsInformation</span><span class="o">*</span> <span class="n">inputs_outputs_information_pointer</span> <span class="o">=</span> <span class="n">neural_network</span><span class="p">.</span><span class="n">get_inputs_outputs_information_pointer</span><span class="p">();</span>

    <span class="n">inputs_outputs_information_pointer</span><span class="o">-&gt;</span><span class="n">set_input_name</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"time"</span><span class="p">);</span>
    <span class="n">inputs_outputs_information_pointer</span><span class="o">-&gt;</span><span class="n">set_output_name</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"feed_rate"</span><span class="p">);</span>

    <span class="n">inputs_outputs_information_pointer</span><span class="o">-&gt;</span><span class="n">set_input_units</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"seconds"</span><span class="p">);</span>
    <span class="n">inputs_outputs_information_pointer</span><span class="o">-&gt;</span><span class="n">set_output_units</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"grams"</span><span class="p">);</span>

    <span class="n">neural_network</span><span class="p">.</span><span class="n">construct_scaling_layer</span><span class="p">();</span>

    <span class="n">ScalingLayer</span><span class="o">*</span> <span class="n">scaling_layer_pointer</span> <span class="o">=</span> <span class="n">neural_network</span><span class="p">.</span><span class="n">get_scaling_layer_pointer</span><span class="p">();</span>

    <span class="n">scaling_layer_pointer</span><span class="o">-&gt;</span><span class="n">set_minimum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
    <span class="n">scaling_layer_pointer</span><span class="o">-&gt;</span><span class="n">set_maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">final_time</span><span class="p">);</span>

    <span class="n">neural_network</span><span class="p">.</span><span class="n">construct_unscaling_layer</span><span class="p">();</span>

    <span class="n">UnscalingLayer</span><span class="o">*</span> <span class="n">unscaling_layer_pointer</span> <span class="o">=</span> <span class="n">neural_network</span><span class="p">.</span><span class="n">get_unscaling_layer_pointer</span><span class="p">();</span>

    <span class="n">unscaling_layer_pointer</span><span class="o">-&gt;</span><span class="n">set_minimum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
    <span class="n">unscaling_layer_pointer</span><span class="o">-&gt;</span><span class="n">set_maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum_feed_rate</span><span class="p">);</span>

    <span class="n">neural_network</span><span class="p">.</span><span class="n">construct_bounding_layer</span><span class="p">();</span>

    <span class="n">BoundingLayer</span><span class="o">*</span> <span class="n">bounding_layer_pointer</span> <span class="o">=</span> <span class="n">neural_network</span><span class="p">.</span><span class="n">get_bounding_layer_pointer</span><span class="p">();</span>

    <span class="n">bounding_layer_pointer</span><span class="o">-&gt;</span><span class="n">set_lower_bound</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
    <span class="n">bounding_layer_pointer</span><span class="o">-&gt;</span><span class="n">set_upper_bound</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">maximum_feed_rate</span><span class="p">);</span>

    <span class="n">neural_network</span><span class="p">.</span><span class="n">initialize_parameters_normal</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0e-3</span><span class="p">);</span>

    <span class="n">PerformanceFunctional</span> <span class="n">performance_functional</span><span class="p">(</span><span class="o">&amp;</span><span class="n">neural_network</span><span class="p">);</span>

    <span class="n">FinalSolutionsError</span><span class="o">*</span> <span class="n">objective_term_pointer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FinalSolutionsError</span><span class="p">(</span><span class="o">&amp;</span><span class="n">neural_network</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fed_batch_fermenter</span><span class="p">);</span>

    <span class="n">objective_term_pointer</span><span class="o">-&gt;</span><span class="n">set_final_solution_error_weight</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
    <span class="n">objective_term_pointer</span><span class="o">-&gt;</span><span class="n">set_final_solution_error_weight</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
    <span class="n">objective_term_pointer</span><span class="o">-&gt;</span><span class="n">set_final_solution_error_weight</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0e-9</span><span class="p">);</span>
    <span class="n">objective_term_pointer</span><span class="o">-&gt;</span><span class="n">set_final_solution_error_weight</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>

    <span class="n">performance_functional</span><span class="p">.</span><span class="n">set_objective_term_pointer</span><span class="p">(</span><span class="n">objective_term_pointer</span><span class="p">);</span>

    <span class="n">FinalSolutionsError</span><span class="o">*</span> <span class="n">constraints_term_pointer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FinalSolutionsError</span><span class="p">(</span><span class="o">&amp;</span><span class="n">neural_network</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fed_batch_fermenter</span><span class="p">);</span>

    <span class="n">constraints_term_pointer</span><span class="o">-&gt;</span><span class="n">set_target_final_solution</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">fermenter_volume</span><span class="p">);</span>

    <span class="n">constraints_term_pointer</span><span class="o">-&gt;</span><span class="n">set_final_solution_error_weight</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
    <span class="n">constraints_term_pointer</span><span class="o">-&gt;</span><span class="n">set_final_solution_error_weight</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
    <span class="n">constraints_term_pointer</span><span class="o">-&gt;</span><span class="n">set_final_solution_error_weight</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
    <span class="n">constraints_term_pointer</span><span class="o">-&gt;</span><span class="n">set_final_solution_error_weight</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.0e-6</span><span class="p">);</span>

    <span class="n">performance_functional</span><span class="p">.</span><span class="n">set_constraints_term_pointer</span><span class="p">(</span><span class="n">constraints_term_pointer</span><span class="p">);</span>

    <span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">parameters</span> <span class="o">=</span> <span class="n">neural_network</span><span class="p">.</span><span class="n">arrange_parameters</span><span class="p">();</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">performance_functional</span><span class="p">.</span><span class="n">calculate_evaluation</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">performance_functional</span><span class="p">.</span><span class="n">calculate_evaluation</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">performance_functional</span><span class="p">.</span><span class="n">calculate_gradient</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">TrainingStrategy</span> <span class="n">training_strategy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">performance_functional</span><span class="p">);</span>

    <span class="n">training_strategy</span><span class="p">.</span><span class="n">construct_initialization_training_algorithm</span><span class="p">(</span><span class="n">TrainingStrategy</span><span class="o">::</span><span class="n">EVOLUTIONARY_ALGORITHM</span><span class="p">);</span>

    <span class="n">training_strategy</span><span class="p">.</span><span class="n">construct_main_training_algorithm</span><span class="p">(</span><span class="n">TrainingStrategy</span><span class="o">::</span><span class="n">QUASI_NEWTON_METHOD</span><span class="p">);</span>

    <span class="n">TrainingStrategy</span><span class="o">::</span><span class="n">Results</span> <span class="n">training_strategy_results</span> <span class="o">=</span> <span class="n">training_strategy</span><span class="p">.</span><span class="n">perform_training</span><span class="p">();</span>

    <span class="n">fed_batch_fermenter</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">"../data/fed_batch_fermenter/fed_batch_fermenter.xml"</span><span class="p">);</span>
    <span class="n">fed_batch_fermenter</span><span class="p">.</span><span class="n">save_data</span><span class="p">(</span><span class="n">neural_network</span><span class="p">,</span> <span class="s">"../data/fed_batch_fermenter_data.dat"</span><span class="p">);</span>

    <span class="n">neural_network</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">"../data/fed_batch_fermenter/neural_network.xml"</span><span class="p">);</span>
    <span class="n">neural_network</span><span class="p">.</span><span class="n">save_expression</span><span class="p">(</span><span class="s">"../data/fed_batch_fermenter/expression.txt"</span><span class="p">);</span>
    <span class="n">neural_network</span><span class="p">.</span><span class="n">save_data</span><span class="p">(</span><span class="s">"../data/fed_batch_fermenter/neural_network_data.dat"</span><span class="p">);</span>

    <span class="n">performance_functional</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">"../data/fed_batch_fermenter/performance_functional.xml"</span><span class="p">);</span>

    <span class="n">training_strategy</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">"../data/fed_batch_fermenter/training_strategy.xml"</span><span class="p">);</span>
    <span class="n">training_strategy_results</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">"../data/fed_batch_fermenter/training_strategy_results.dat"</span><span class="p">);</span>

    <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>

<p><img alt="Alt text" src="../images/FedBatchFermenter.gif" /></p>

<p>Problem parameters</p>

<p>Mathematical model</p>

<p>Neural network
<br>
<br>
<br>
Inputs-outputs information
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
Scaling layer
<br>
<br>
<br>
<br>
<br>
Unscaling layer
<br>
<br>
<br>
<br>
<br>
<br>
<br>
Bounding layer
<br>
<br>
<br>
<br>
Performance functional</p>

<p>Objective term
<br>
<br>
<br>
<br>
<br>
<br>
<br>
Constraints term
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
Training strategy</p>

<p>Initialization training algorithm</p>

<p>Main training algorithm
<br>
<br>
<br>
Save results</p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
